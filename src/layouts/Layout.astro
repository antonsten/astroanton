---
import { ViewTransitions } from 'astro:transitions';
import '../styles/critical.css';
import '../styles/global.css';
import HtmlHead from '../components/HtmlHead.astro';
import ScrollAnimation from '../components/ScrollAnimation.astro';
import Footer from '../components/Footer.astro';
import CanonicalUrl from '../components/CanonicalUrl.astro';
import Navigation from '../components/Navigation.astro';
import PersonSchema from '../components/PersonSchema.astro';

interface Props {
	title: string;
	description?: string;
	path?: string;
}

const { 
	title, 
	description = "Anton Sten is a UX lead and product designer helping teams build better digital products through thoughtful design, collaboration, and strategy.",
	path = ''
} = Astro.props;

// Get the success state from the URL
const success = Astro.url.searchParams.get('success') === 'true';

// Inline critical CSS
const criticalCSS = await Astro.slots.render('critical-css');
---

<!doctype html>
<html lang="en">
	<head>
		<HtmlHead title={title} description={description} />
		<style is:inline>{criticalCSS}</style>
		<link rel="stylesheet" href="/styles/global.css" media="print" onload="this.media='all'" />
		<noscript><link rel="stylesheet" href="/styles/global.css" /></noscript>
		<!-- Netlify Identity Widget -->
		<script src="/js/netlify-identity.js" defer></script>
	</head>
	<body class="bg-white text-black antialiased">
		<ScrollAnimation>
			<div class="fixed top-0 left-0 w-full z-50 pointer-events-none">
				<div class="max-w-[700px] mx-auto px-4">
					<h1 class="text-[32px] leading-[40px] tracking-[-0.02em] font-medium text-black opacity-0 transition-opacity duration-300" id="scroll-title">Studio Anton Sten</h1>
				</div>
			</div>
			<Navigation path={path} />
			<main class="min-h-screen">
				<slot />
			</main>
			<Footer />
		</ScrollAnimation>
		<PersonSchema />
	</body>
</html>

<style is:global>
	/* Add any global styles here */
	html {
		font-family: 'Suisse Intl', system-ui, sans-serif;
	}
</style>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const mainContent = document.querySelector('main');
		const fixedNav = document.querySelector('.fixed .flex') as HTMLElement;
		const originalNav = document.querySelector('nav') as HTMLElement;
		const scrollTitle = document.getElementById('scroll-title') as HTMLElement;
		
		if (!mainContent || !fixedNav || !originalNav || !scrollTitle) return;

		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					originalNav.style.opacity = '0';
					fixedNav.style.opacity = '1';
					scrollTitle.style.opacity = '1';
				} else {
					originalNav.style.opacity = '1';
					fixedNav.style.opacity = '0';
					scrollTitle.style.opacity = '0';
				}
			});
		}, {
			threshold: 0.5
		});

		observer.observe(mainContent);
	});

	// Initialize Netlify Identity
	document.addEventListener('DOMContentLoaded', () => {
		if (window.netlifyIdentity) {
			window.netlifyIdentity.on("init", user => {
				if (!user) {
					window.netlifyIdentity.on("login", () => {
						document.location.href = "/admin/";
					});
				}
			});
		}
	});
</script>
